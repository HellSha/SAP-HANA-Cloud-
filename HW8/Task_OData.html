<html>
    <head>
        <title>
            HW8 - Alena Shaadt
        </title> 
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    </head>
    <body>
        <table id="navigation">
            <tr>
                <th><button id="search" type="button" class="btn btn-primary">oData Search</button></th>
                <th><button id="select" type="button" class="btn btn-primary">oData Select</button></th>
                <th><button id="count" type="button" class="btn btn-primary">oData Count</button></th>
                <th><button id="filter" type="button" class="btn btn-primary">oData Filter</button></th>
                <th><button id="skip" type="button" class="btn btn-primary">oData Skip</button></th>
                <th><button id="top" type="button" class="btn btn-primary">oData Top</button></th>
                <th><button id="order-by" type="button" class="btn btn-primary">oData OrderBy</button></th>
                <th><button id="lambda" type="button" class="btn btn-primary">oData Lambda Filtering</button></th>
            </tr>
        </table>
        <table id="added-articles" class="w3-table w3-striped w3-bordered">
        </table>
        <script type="text/javascript" src="js/q.js"></script>
        <script type="text/javascript" src="js/o.min.js"></script>
        <script type="text/javascript" src="js/odatajs-4.0.0.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script>
            
           function Person(username, firstname, lastname, gender, concurrency) {
              this.username = username;
              this.firstname = firstname;
              this.lastname = lastname;
              this.gender = gender;
              this.concurrency = concurrency;
            }
        
            function createObjectsArray(data){
                var personsArray = [];                    
                    $.each(data.value, function (key, data) {
                        var person = new Person(data.UserName, data.FirstName, data.LastName, data.Gender, data.Concurrency);
                            personsArray.push(person);
                        })
                return personsArray;
            }
            
           
            function showData(personArray){
                var trHTML = '<tr><th>User Name</th><th>First Name</th><th>Last Name</th><th>Gender</th><th>Concurrency</th></tr>';
                     for (i = 0; i < personArray.length; i++) {
                          trHTML += '<tr><td>' + personArray[i].username + '</td><td>' + personArray[i].firstname + '</td><td>' + personArray[i].lastname + '</td><td>' + personArray[i].gender  + '</td><td>' + personArray[i].concurrency  + '</td></tr>';
                        } 
                        $('#added-articles').append(trHTML);
                }
            
            function basicConfig(){
                  //document.getElementById("getoutput").style.display = "none";
                  document.getElementById("added-articles").style.display = "block";
                  document.getElementById("added-articles").innerHTML = "";
            }
            
                
                //GET by Search oData Filtering
            $('#search').on('click', function() {
             $.ajax({
                type: "get",
                async: true,
                url: "https://services.odata.org/V4/(S(htf1jmmysolh4pyvhgn1umse))/TripPinServiceRW/People?$search=Male",
                success: function (data) {
                    basicConfig();
                    showData(createObjectsArray(data));
                },
                error: function (xhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
            });
            
               //GET by Select oData Filtering
             $('#select').on('click', function() {
              $.ajax({
                type: "get",
                async: true,
                url: "https://services.odata.org/V4/(S(htf1jmmysolh4pyvhgn1umse))/TripPinServiceRW/People?$select=UserName,%20Gender",
                success: function (data) {  
                    basicConfig();
                    showData(createObjectsArray(data));
                },
                error: function (xhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
             });
            
                //GET by Count oData 
            $('#count').on('click', function() {
              $.ajax({
                type: "get",
                async: true,
                url: "https://services.odata.org/V4/(S(htf1jmmysolh4pyvhgn1umse))/TripPinServiceRW/People/$count",
                success: function (data) { 
                    alert("Amount of people using $count: " + data);
                },
                error: function (xhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
             });
            
                //GET by Filter oData
            $('#filter').on('click', function() {
              $.ajax({
                type: "get",
                async: true,
                url: "https://services.odata.org/V4/TripPinServiceRW/People?$filter=Emails/any(s:endswith(s, 'contoso.com'))",
                success: function (data) {
                    basicConfig();
                    showData(createObjectsArray(data));
                },
                error: function (xhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
            });
            
                //GET using Skip OData
            $('#skip').on('click', function() {
              $.ajax({
                type: "get",
                async: true,
                url: "https://services.odata.org/V4/(S(htf1jmmysolh4pyvhgn1umse))/TripPinServiceRW/People?$skip=5",
                success: function (data) {
                    basicConfig();
                    showData(createObjectsArray(data));
                },
                error: function (xhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
            });
            
                //GET using Top OData
            $('#top').on('click', function() {
              $.ajax({
                type: "get",
                async: true,
                url: "https://services.odata.org/V4/(S(htf1jmmysolh4pyvhgn1umse))/TripPinServiceRW/People?$top=3",
                success: function (data) {
                    basicConfig();
                    showData(createObjectsArray(data));
                },
                error: function (xhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
            });
            
                //GET Order by Filtering OData
            $('#order-by').on('click', function() {
              $.ajax({
                type: "get",
                async: true,
                url: "https://services.odata.org/V4/(S(htf1jmmysolh4pyvhgn1umse))/TripPinServiceRW/People?$orderby=FirstName",
                success: function (data) {
                    basicConfig();
                    showData(createObjectsArray(data));
                },
                error: function (xhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
            });
            
              //GET Request with combination of 3 filters
            $('#order-by').on('click', function() {
              $.ajax({
                type: "get",
                async: true,
                url: "https://services.odata.org/V4/(S(htf1jmmysolh4pyvhgn1umse))/TripPinServiceRW/People?$orderby=FirstName",
                success: function (data) {
                    basicConfig();
                    showData(createObjectsArray(data));
                },
                error: function (xhr, textStatus, errorMessage) {
                    alert(errorMessage);
                }
            });
            });
        </script>
    </body>
</html>